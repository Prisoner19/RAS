<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                template="/template/esqueleto.xhtml" >



    <ui:define name="content">
    <script type="text/javascript" src="#{request.contextPath}/resources/js/calendar-es.js"></script>
	 
	 <script>
	
		function handleComplete(xhr, status, args) {  
		    if(args.validationFailed) { 	    	
		    	showError();	    	
		    }	   
		} 	 
	 </script>
    
    <h:form id="form">

		<p:growl id="growl" showDetail="true" life="3000" />

		<p:dialog id="dialogPresupuesto" header="Presupuesto Estimado" widgetVar="dialogPresupuesto"
			resizable="false" width="500" height="300" showEffect="clip"
			hideEffect="fold" modal="true">
			
			<h:panelGrid id="displayPresupuesto" columns="2" cellpadding="4">
				
			<h:outputText value="Nombre de Proyecto:" rendered="#{!ProyectoBean.accionEditar}"/>
               <p:inputText value="#{ProyectoBean.proyecto.nombre}" rendered="#{!ProyectoBean.accionEditar}"
               required="true" />

               <h:outputText value="Descripcion:" rendered="#{!ProyectoBean.accionEditar}"/>
               <p:inputText value="#{ProyectoBean.proyecto.descripcion}" rendered="#{!ProyectoBean.accionEditar}"
               required="true" />
               
               <h:outputText value="Fecha de Inicio:" rendered="#{!ProyectoBean.accionEditar}"/>
               <p:calendar value="#{ProyectoBean.proyecto.inicio}" id="calendarNuevo" rendered="#{!ProyectoBean.accionEditar}"
                    required="true"   navigator="true" display="inline" effect="slide" yearRange="c-5:c+5"
                    timeZone="#{ProyectoBean.timeZone()}"/>				
				
				<h:outputText value="Costo de Personal:" />
				<pe:inputNumber value="#{ProyectoBean.proyecto.costoPersonal}" required="true"
				decimalPlaces="2" thousandSeparator=""/>
				
				<h:outputText value="Costo de Equipos:" />
				<pe:inputNumber value="#{ProyectoBean.proyecto.costoEquipo}" required="true"
				decimalPlaces="2" thousandSeparator=""/>
				
				<h:outputText value="Otros Gastos:" />
				<pe:inputNumber value="#{ProyectoBean.proyecto.costoOtros}" required="true"
				decimalPlaces="2" thousandSeparator=""/>
			
				<p:commandButton value="#{ProyectoBean.etiBotonDialog()}"
					actionListener="#{ProyectoBean.procesarDialog}" oncomplete="handleComplete(xhr, status, args);"
					update="@form:datatablecampana,@form:displayPresupuesto"/>			
						
			</h:panelGrid>
		</p:dialog>
		
		<p:panel>

			<div id="cuerpo">

				<p:dataTable id="datatablecampana" var="c" widgetVar="dt"
					value="#{ProyectoBean.proyectos}" rowKey="#{c.idProyecto}"
					selection="#{ProyectoBean.proyectoSelec}" selectionMode="single" rowIndexVar="index"
					styleClass="datatable_style_general" editable="true" paginator="true" rows="10"
					paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					rowsPerPageTemplate="2,5,10">

					<f:facet name="header">

						<p:commandButton id="viewEditarPresupuesto" styleClass="botonPeque"
							value="Editar Presupuesto" icon="ui-icon-search" process="@form:datatablecampana"
							update=":form:displayPresupuesto, :form:growl"
							actionListener="#{ProyectoBean.editarEvent}" />

					</f:facet>
					
					<p:ajax event="rowEdit" listener="#{ProyectoBean.onEdit}" update=":form:growl" />  
        			<p:ajax event="rowEditCancel" listener="#{ProyectoBean.onCancel}" update=":form:growl" /> 
					
					<p:column styleClass="columna" headerText="Nombre"
						filterBy="#{c.nombre}" footerText="nombre">
						<p:cellEditor>
							<f:facet name="output">
								<div onclick="selectCurrentRow_paginator(dt,#{index})">
									<h:outputText value="#{c.nombre}" />
								</div>
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{c.nombre}" style="width:100%"/>
							</f:facet>
						</p:cellEditor>
					</p:column>
					
					<p:column styleClass="columna" headerText="Descripcion" filterBy="#{c.descripcion}"
						footerText="descripcion">
						<p:cellEditor>
							<f:facet name="output">
								<div onclick="selectCurrentRow_paginator(dt,#{index})">
									<h:outputText value="#{c.descripcion}" />
								</div>
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{c.descripcion}" style="width:100%"/>
							</f:facet>
						</p:cellEditor>
					</p:column>
					
					<p:column styleClass="columna" headerText="Fecha de Inicio" filterBy="#{c.descripcion}"
						footerText="inicio">
						<p:cellEditor>
							<f:facet name="output">
								<div onclick="selectCurrentRow_paginator(dt,#{index})">
									<h:outputText value="#{c.inicio}" />
								</div>
							</f:facet>
							<f:facet name="input">
								<p:calendar value="#{c.inicio}" id="calendarEditar" 
									navigator="true" display="inline" effect="slide" yearRange="c-100:c-0"/>
							</f:facet>
						</p:cellEditor>
					</p:column>
					
					<p:column styleClass="columna" headerText="Cierre de Proyecto" sortBy="#{c.cierre}" >
						<div style="text-align: center;" onclick="selectCurrentRow_paginator(dt,#{index})">

							<p:selectBooleanButton value="#{c.cierre}" styleClass="toggle"  onLabel="SÍ" offLabel="NO" 
													onIcon="ui-icon-check" offIcon="ui-icon-close"
													>  
											
								<p:ajax listener="#{ProyectoBean.toggle(index)}" process="@form:datatablecampana">									
								</p:ajax>  
					            
					        </p:selectBooleanButton>  

					    </div>
					</p:column>
							
					<p:column style="width:6%">
						<f:facet name="header">
							<h:panelGrid columns="2">
						    	<p:commandButton id="nuevo" icon="ui-icon-plusthick" 
						    	styleClass="botonPeque" actionListener="#{ProyectoBean.nuevoEvent}"  update="@form:displayPresupuesto" process="@this">
						    		<p:resetInput target=":form:displayPresupuesto"></p:resetInput>
						    	</p:commandButton>
						    	<p:commandButton id="eliminar" icon="ui-icon-trash" styleClass="botonPeque" process="@form:datatablecampana"
						         update="@form:datatablecampana" actionListener="#{ProyectoBean.eliminarEvent}">
						    		<p:confirm header="Confirmación" message="¿Seguro desea eliminar el registro?" 
						    		icon="ui-icon-alert" /> 
						    	</p:commandButton>
							</h:panelGrid>
						</f:facet>
						
						<p:rowEditor />
					</p:column>					
				
				</p:dataTable>
			</div>

		</p:panel>
		
		<p:remoteCommand name="showError" actionListener="#{ProyectoBean.showError}" immediate="true" />
		
		<p:confirmDialog global="true" showEffect="fade" hideEffect="explode">  
	        <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>  
	        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>       
    	</p:confirmDialog>      	
    	
	

	</h:form>

 </ui:define>


</ui:composition>
